@using Backend 

<center>
    <h3>@Name</h3>

    <table class="table-auto" style="width: 100%">
        @for (int row = 0; row < Rows; row++)
        {
            <tr>
                @for (int col = 0; col < Cols; col++)
                {
                    <td class="border px-2 py-1">
                        <center>
                            <b>@GetId(row, col)</b>
                            <p>@GetValue(row, col)</p>
                        </center>
                    </td>
                }
            </tr>
        }
    </table>

    @foreach (var item in new string[] { "binary", "decimal", "hex" })
    {
        <div>
            <input type="radio" name="@Name" id="@(Name)-@(item)" value="@item" @onchange="RadioSelection" checked=@(RadioValue.Equals(item,StringComparison.OrdinalIgnoreCase)) />
            <label for="@(Name)-@(item)">@item</label>
        </div>
    }
</center>

@code {
    [Parameter] public string Name { get; set; }
    [Parameter] public Backend.GeneralStorage Data { get; set; }

    [Parameter] public int Rows { get; set; }
    [Parameter] public int Cols { get; set; }

    public string RadioValue = "hex";

    public int GetId(int row, int col)
    {
        return (row * Cols) + col;
    }

    public string GetValue(int row, int col)
    {
        //Find id and calculate base based upon selected value
        int id = GetId(row, col);
        int b = RadioValue switch
        {
            "binary" => 2,
            "decimal" => 10,
            "hex" => 16,
            _ => 10
        };

        //Convert the value into the wanted base
        string value = Convert.ToString(Data.GetData(id), b);

        string output = "";
        if (b != 10 && value != "0")
        {
            //Find the chunk size such that 1 chunk represents 256 states (such as 2 hex chars)
            int chunkSize = (int)Math.Log(256, b);

            //Calculate the length needed to get to next multiple of chunkSize, and pad to that size
            int padAmount = (int)(chunkSize * Math.Ceiling(value.Length / (float)chunkSize));
            value = value.PadLeft(padAmount, '0');

            //Select chunks in the given size, interlace with spaces
            for (int i = 0; i <= value.Length - chunkSize; i += chunkSize)
                output += value.Substring(i, chunkSize) + " ";
        }
        else
        {
            output = value;
        }

        return output.ToUpper();
    }

    void RadioSelection(ChangeEventArgs args)
    {
        RadioValue = args.Value.ToString();
    }
}
